---
/**
 * Blog Post Page - Gutted for Redesign
 *
 * Preserves all data fetching, routing logic, and schemas.
 */

import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getBusinessProfile, getPhoneLink } from '../../lib/getBusinessProfile';
import { getArticleSchema } from '../../lib/schema';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content } = await post.render();
const profile = await getBusinessProfile();

const schema = getArticleSchema(profile, {
  title: post.data.title,
  description: post.data.description,
  slug: post.slug,
  publishDate: post.data.publishDate,
  modifiedDate: post.data.modifiedDate,
  author: post.data.author,
  image: post.data.image,
});

const title = post.data.seoTitle || `${post.data.title} - B.A.P Heating and Cooling`;
const description = post.data.seoDescription || post.data.description;

// Default image if none provided
const featuredImage = post.data.image || '/images/blog/default-blog.svg';

// Get related posts (same category, excluding current)
const allPosts = await getCollection('blog');
const relatedPosts = allPosts
  .filter(p => p.data.category === post.data.category && p.slug !== post.slug)
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .slice(0, 2);

// Category display names
const categoryNames: Record<string, string> = {
  heating: 'Heating',
  cooling: 'Cooling',
  maintenance: 'Maintenance',
  efficiency: 'Energy Efficiency',
  guides: 'Guides',
  news: 'News',
};
---

<BaseLayout
  title={title}
  description={description}
  robots={post.data.robots}
  schema={schema}
  ogImage={featuredImage}
>
  <div class="redesign-placeholder">
    <h1>{post.data.title}</h1>
    <p>Blog post page redesign in progress.</p>
    <p style="margin-top: 1rem; font-size: 0.875rem; color: #64748b;">
      Category: {categoryNames[post.data.category] || post.data.category}
    </p>
  </div>
</BaseLayout>
