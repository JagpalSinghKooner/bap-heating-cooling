---
/**
 * Service Category Page - Gutted for Redesign
 *
 * Preserves all data fetching and routing logic.
 */

import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { getBusinessProfile } from '../../lib/getBusinessProfile';
import { getLocalBusinessSchema } from '../../lib/schema';
import type { RegionLocationMap } from '../../lib/types';

export async function getStaticPaths() {
  const categories = [
    {
      slug: 'heating',
      title: 'Heating Services',
      description: 'Professional heating installation, repair, and maintenance services for your home or business.',
      category: 'heating'
    },
    {
      slug: 'cooling',
      title: 'Cooling Services',
      description: 'Expert air conditioning installation, repair, and maintenance to keep you comfortable all summer.',
      category: 'cooling'
    },
    {
      slug: 'indoor-air-quality',
      title: 'Indoor Air Quality Services',
      description: 'Improve your indoor air quality with our professional air filtration, purification, and ventilation solutions.',
      category: 'iaq'
    },
    {
      slug: 'water-heating',
      title: 'Water Heating Services',
      description: 'Reliable water heater installation, repair, and maintenance for consistent hot water.',
      category: 'water-heating'
    },
    {
      slug: 'commercial',
      title: 'Commercial HVAC Services',
      description: 'Comprehensive commercial heating, cooling, and ventilation solutions for businesses of all sizes.',
      category: 'commercial'
    },
    {
      slug: 'maintenance-plans',
      title: 'HVAC Maintenance Plans',
      description: 'Preventive maintenance plans to keep your HVAC system running efficiently year-round.',
      category: 'plans'
    },
  ];

  return categories.map((cat) => ({
    params: { category: cat.slug },
    props: cat,
  }));
}

const { title, description, category } = Astro.props;

// Load all services and filter by category
const allServices = await getCollection('services');
const categoryServices = allServices
  .filter(s => s.data.category === category)
  .sort((a, b) => a.data.order - b.data.order);

// Load all locations for service-city links
const allLocations = await getCollection('locations');

// Load all regions
const allRegions = await getCollection('regions');

// Group locations by region
const cleanSlug = (id: string) => id.replace(/\.md$/, '');
const locationsByRegion: Map<string, RegionLocationMap> = new Map();

for (const region of allRegions) {
  const regionSlug = cleanSlug(region.id);
  const regionLocations = allLocations.filter((loc) =>
    region.data.cities.includes(cleanSlug(loc.id))
  );
  locationsByRegion.set(regionSlug, {
    region: region,
    locations: regionLocations
  });
}

// Get business profile
const profile = await getBusinessProfile();

// Load reviews
const allReviews = await getCollection('reviews');
const liveReviews = allReviews.filter(r => r.data.status === 'live');

// Schema
const schema = getLocalBusinessSchema(profile);

const seoTitle = `${title} - B.A.P Heating and Cooling`;
const seoDescription = description;
---

<BaseLayout
  title={seoTitle}
  description={seoDescription}
  robots="index,follow"
  schema={schema}
>
  <div class="redesign-placeholder">
    <h1>{title}</h1>
    <p>Category page redesign in progress. {categoryServices.length} services available.</p>
  </div>
</BaseLayout>
