---
/**
 * Reviews Index Page - Gutted for Redesign
 *
 * Preserves all data fetching logic.
 */

import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { getBusinessProfile } from '../lib/getBusinessProfile';
import { getAllReviewsForReviewsPage } from '../lib/reviewResolver';
import { generateReviewSchemas } from '../lib/reviewSchema';
import { getLocalBusinessSchema } from '../lib/schema';

const profile = await getBusinessProfile();

// Load all reviews
const allReviews = await getCollection('reviews');

// Get reviews for reviews page (all sources, sorted properly)
const pageReviews = getAllReviewsForReviewsPage(allReviews);

// Generate review schemas (only for verified reviews)
const reviewSchemas = generateReviewSchemas(pageReviews);

// Build schema array
const schemas = [getLocalBusinessSchema(profile)];

// Only add review schemas if there are verified reviews
if (reviewSchemas.length > 0) {
  schemas.push(...reviewSchemas);
}

const schema = schemas;
---

<BaseLayout
  title="Customer Reviews - B.A.P Heating and Cooling"
  description="Read reviews from our satisfied customers across Southern Ontario. See what people are saying about our heating and cooling services."
  schema={schema}
>
  <div class="redesign-placeholder">
    <h1>Customer Reviews</h1>
    <p>Reviews page redesign in progress. {pageReviews.length} reviews available.</p>
  </div>
</BaseLayout>
