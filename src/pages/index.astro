---
/**
 * Homepage - Gutted for Redesign
 *
 * Preserves all data fetching and schema logic.
 * Visual components will be rebuilt in Phase 4-6.
 */

import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { getBusinessProfile } from '../lib/getBusinessProfile';
import { getLocalBusinessSchema } from '../lib/schema';
import { resolveFAQs } from '../lib/faqResolver';
import { generateFAQSchema } from '../lib/faqSchema';
import { getSiteReviewBlock } from '../lib/reviewResolver';
import { generateReviewSchemas } from '../lib/reviewSchema';

const profile = await getBusinessProfile();

// Load all FAQs
const allFAQs = await getCollection('faqs');

// Resolve FAQs for homepage
const pageFAQs = resolveFAQs(allFAQs, {
  pageType: 'homepage',
});

// Generate FAQ schema if FAQs exist
const faqSchema = generateFAQSchema(pageFAQs);

// Load reviews for homepage
const allReviews = await getCollection('reviews');
const siteReviews = getSiteReviewBlock(allReviews);

// Generate review schemas (only for verified reviews)
const reviewSchemas = generateReviewSchemas(siteReviews);

// Build schema array
const schemas = [getLocalBusinessSchema(profile)];
if (faqSchema) {
  schemas.push(faqSchema);
}
if (reviewSchemas.length > 0) {
  schemas.push(...reviewSchemas);
}

const schema = schemas;
---

<BaseLayout
  title="Furnace & AC Installation Guelph ON | 24/7 HVAC | B.A.P Heating"
  description="24/7 emergency HVAC in Guelph & Ontario. Furnace installation, AC repair, heat pumps. Family-owned since 1994. 10-year warranty. Free estimates: 519-835-4858"
  schema={schema}
>
  <!-- Homepage placeholder - will be rebuilt in Phase 4-6 -->
  <div class="redesign-placeholder">
    <h1>Homepage</h1>
    <p>Website redesign in progress. Components will be built using the frontend-design skill.</p>
  </div>
</BaseLayout>
