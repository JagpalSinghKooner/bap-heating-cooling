---
import BaseLayout from '../layouts/BaseLayout.astro';
import ReviewsBlock from '../components/ReviewsBlock.astro';
import PrimaryCTA from '../components/PrimaryCTA.astro';
import { getCollection } from 'astro:content';
import { getBusinessProfile } from '../lib/getBusinessProfile';
import { getLocalBusinessSchema } from '../lib/schema';
import { resolveFAQs } from '../lib/faqResolver';
import { generateFAQSchema } from '../lib/faqSchema';
import { getSiteReviewBlock } from '../lib/reviewResolver';
import { generateReviewSchemas } from '../lib/reviewSchema';

const profile = await getBusinessProfile();

// Load all FAQs
const allFAQs = await getCollection('faqs');

// Resolve FAQs for homepage
const pageFAQs = resolveFAQs(allFAQs, {
  pageType: 'homepage',
});

// Generate FAQ schema if FAQs exist
const faqSchema = generateFAQSchema(pageFAQs);

// Load reviews for homepage
const allReviews = await getCollection('reviews');
const siteReviews = getSiteReviewBlock(allReviews);

// Generate review schemas (only for verified reviews)
const reviewSchemas = generateReviewSchemas(siteReviews);

// Build schema array
const schemas = [getLocalBusinessSchema(profile)];
if (faqSchema) {
  schemas.push(faqSchema);
}
if (reviewSchemas.length > 0) {
  schemas.push(...reviewSchemas);
}

const schema = schemas;
---

<BaseLayout
  title="Home - B.A.P Heating and Cooling"
  description="Professional heating and cooling services for your home and business"
  schema={schema}
>
  <div class="container mx-auto px-4 py-16">
    <section class="text-center">
      <h1 class="mb-6 text-5xl font-bold">Welcome to B.A.P Heating & Cooling</h1>
      <p class="mx-auto max-w-2xl text-xl text-muted-foreground">
        Your trusted partner for all heating and cooling needs. Professional service,
        reliable solutions, and customer satisfaction guaranteed.
      </p>

      <div class="mt-8 flex justify-center gap-4">
        <PrimaryCTA variant="call" context="homepage-hero" size="large" />
        <PrimaryCTA variant="book" context="homepage-hero" size="large" />
      </div>
    </section>

    <section class="mt-16">
      <div class="grid gap-8 md:grid-cols-3">
        <div class="rounded-lg border bg-card p-6">
          <h3 class="mb-3 text-xl font-semibold">Expert Service</h3>
          <p class="text-muted-foreground">
            Certified technicians with years of experience in HVAC systems.
          </p>
        </div>
        <div class="rounded-lg border bg-card p-6">
          <h3 class="mb-3 text-xl font-semibold">24/7 Support</h3>
          <p class="text-muted-foreground">
            Emergency services available around the clock for your peace of mind.
          </p>
        </div>
        <div class="rounded-lg border bg-card p-6">
          <h3 class="mb-3 text-xl font-semibold">Quality Guaranteed</h3>
          <p class="text-muted-foreground">
            All work backed by our satisfaction guarantee and warranty.
          </p>
        </div>
      </div>
    </section>

    <ReviewsBlock reviews={siteReviews} title="What Our Customers Say" />

    <div class="mt-12 rounded-lg border bg-muted p-8">
      <h2 class="mb-4 text-2xl font-semibold text-center">Ready to Get Started?</h2>
      <p class="mb-6 text-muted-foreground text-center">
        Contact us today for expert heating and cooling services.
      </p>
      <div class="flex justify-center gap-4">
        <PrimaryCTA variant="call" context="homepage-footer" />
        <PrimaryCTA variant="book" context="homepage-footer" />
      </div>
    </div>
  </div>
</BaseLayout>
