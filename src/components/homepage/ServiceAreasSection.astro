---
/**
 * Service Areas Section - Premium Location Cards
 * Visual, colorful display of service coverage
 */

import { getBusinessProfile } from '../../lib/getBusinessProfile';
import Section from '../primitives/Section.astro';

const profile = await getBusinessProfile();

// Helper: Convert region name to slug
function regionNameToSlug(name: string): string {
  return name.toLowerCase()
    .replace(/&/g, 'and')
    .replace(/\s+/g, '-')
    .replace(/[^a-z0-9-]/g, '');
}

// Sort regions and locations alphabetically
const allRegions = [...profile.coverage.regions]
  .map((region) => ({
    ...region,
    slug: regionNameToSlug(region.name),
    locations: [...region.locations].sort((a, b) => a.name.localeCompare(b.name)),
  }))
  .sort((a, b) => a.name.localeCompare(b.name));

// Display all regions in a 3-column grid
const regions = allRegions;

// Card styling - cycling brand colors for visual interest
const cardStyles = [
  { bg: 'bg-gradient-to-br from-primary/5 to-primary/10', icon: 'text-primary', iconBg: 'bg-primary/10' },
  { bg: 'bg-gradient-to-br from-brand-orange/5 to-brand-orange/10', icon: 'text-brand-orange', iconBg: 'bg-brand-orange/10' },
  { bg: 'bg-gradient-to-br from-green-500/5 to-green-500/10', icon: 'text-green-600', iconBg: 'bg-green-500/10' },
  { bg: 'bg-gradient-to-br from-purple-500/5 to-purple-500/10', icon: 'text-purple-600', iconBg: 'bg-purple-500/10' },
  { bg: 'bg-gradient-to-br from-cyan-500/5 to-cyan-500/10', icon: 'text-cyan-600', iconBg: 'bg-cyan-500/10' },
  { bg: 'bg-gradient-to-br from-rose-500/5 to-rose-500/10', icon: 'text-rose-600', iconBg: 'bg-rose-500/10' },
];
---

<Section variant="default">
  <!-- Header -->
  <div class="mb-10 text-center">
      <p class="eyebrow mb-3">Service Areas</p>
      <h2 class="section-title mx-auto mb-4 max-w-3xl">
        Proudly serving your community
      </h2>
      <p class="mx-auto max-w-2xl text-base text-muted-foreground">
        Local technicians who know your neighborhood. Fast response times across Guelph, Wellington County, and surrounding regions.
      </p>
    </div>

    <!-- Regions Grid - 3 Cards -->
    <div class="grid gap-6 md:grid-cols-3">
      {regions.map((region, index) => {
        const style = cardStyles[index % cardStyles.length];
        return (
          <div class={`group rounded-2xl border border-border ${style.bg} p-6 transition-all duration-300 hover:shadow-lg hover:scale-[1.02]`}>
            <!-- Icon + Title -->
            <div class="mb-4 flex items-center gap-3">
              <div class={`flex h-12 w-12 items-center justify-center rounded-xl ${style.iconBg}`}>
                <svg class={`h-6 w-6 ${style.icon}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <h3 class="text-lg font-bold text-foreground">{region.name}</h3>
            </div>

            <!-- Locations List -->
            <ul class="mb-4 space-y-2">
              {region.locations.slice(0, 5).map((location) => (
                <li class="flex items-center gap-2 text-sm text-muted-foreground">
                  <svg class={`h-4 w-4 flex-shrink-0 ${style.icon}`} fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <a
                    href={`/locations/${location.slug}/`}
                    class="transition-colors hover:text-foreground"
                  >
                    {location.name}
                  </a>
                </li>
              ))}
            </ul>

            <!-- More Link -->
            {region.locations.length > 5 && (
              <a
                href="/locations/"
                class={`inline-flex items-center gap-1 text-sm font-medium ${style.icon} transition-all group-hover:gap-2`}
              >
                <span>+{region.locations.length - 5} more areas</span>
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </a>
            )}
          </div>
        );
      })}
    </div>

    <!-- All locations link -->
    <div class="mt-10 text-center">
      <a
        href="/locations/"
        class="inline-flex items-center gap-2 rounded-full border border-border bg-background px-6 py-3 font-medium text-foreground shadow-sm transition-all hover:border-primary hover:shadow-md"
      >
        <svg class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
        </svg>
        <span>View all service areas</span>
        <svg class="h-4 w-4 text-muted-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
        </svg>
      </a>
    </div>
</Section>
