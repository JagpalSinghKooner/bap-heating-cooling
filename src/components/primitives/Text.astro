---
/**
 * Text Component
 *
 * Body text primitive for paragraphs, spans, and text blocks.
 * Uses Source Sans 3 - Adobe's highly readable workhorse font.
 *
 * The "Trustworthy Industrial Modern" aesthetic means:
 * - Clean, readable body text
 * - Comfortable line heights for scanning
 * - Clear hierarchy through size and color
 */

interface Props {
  /** Font size variant */
  size?: 'xs' | 'sm' | 'base' | 'lg' | 'xl';
  /** Font weight */
  weight?: 'normal' | 'medium' | 'semibold' | 'bold';
  /** Text color variant */
  color?: 'primary' | 'secondary' | 'tertiary' | 'inverse' | 'accent' | 'emergency' | 'success' | 'inherit';
  /** HTML element to render */
  as?: 'p' | 'span' | 'div' | 'label' | 'strong' | 'em';
  /** Line height variant */
  leading?: 'none' | 'tight' | 'snug' | 'normal' | 'relaxed' | 'loose';
  /** Text alignment */
  align?: 'left' | 'center' | 'right' | 'justify';
  /** Whether to truncate with ellipsis */
  truncate?: boolean;
  /** Max lines before truncation (requires truncate) */
  maxLines?: 1 | 2 | 3 | 4 | 5;
  /** Apply prose styling for rich content */
  prose?: boolean;
  /** Additional classes */
  class?: string;
}

const {
  size = 'base',
  weight = 'normal',
  color = 'primary',
  as: Element = 'p',
  leading,
  align,
  truncate = false,
  maxLines,
  prose = false,
  class: className = '',
} = Astro.props;

// Size configurations
const sizeClasses: Record<string, string> = {
  xs: 'text-body-xs',     // 12px
  sm: 'text-body-sm',     // 14px
  base: 'text-body-base', // 16px
  lg: 'text-body-lg',     // 17-18px
  xl: 'text-body-xl',     // 20px
};

// Weight classes
const weightClasses: Record<string, string> = {
  normal: 'font-normal',
  medium: 'font-medium',
  semibold: 'font-semibold',
  bold: 'font-bold',
};

// Color classes
const colorClasses: Record<string, string> = {
  primary: 'text-body-primary',
  secondary: 'text-body-secondary',
  tertiary: 'text-body-tertiary',
  inverse: 'text-body-inverse',
  accent: 'text-body-accent',
  emergency: 'text-body-emergency',
  success: 'text-body-success',
  inherit: 'text-inherit',
};

// Line height classes
const leadingClasses: Record<string, string> = {
  none: 'leading-none',
  tight: 'leading-tight',
  snug: 'leading-snug',
  normal: 'leading-normal',
  relaxed: 'leading-relaxed',
  loose: 'leading-loose',
};

// Default line heights based on size (for optimal readability)
const defaultLeadingMap: Record<string, string> = {
  xs: 'normal',
  sm: 'normal',
  base: 'relaxed',
  lg: 'relaxed',
  xl: 'relaxed',
};

// Alignment classes
const alignClasses: Record<string, string> = {
  left: 'text-left',
  center: 'text-center',
  right: 'text-right',
  justify: 'text-justify',
};

// Truncation classes
const truncateClass = truncate && !maxLines ? 'truncate-text' : '';
const lineClampClass = truncate && maxLines ? `line-clamp-${maxLines}` : '';

// Build class string
const actualLeading = leading || defaultLeadingMap[size];

const classes = [
  'font-body',
  sizeClasses[size],
  weightClasses[weight],
  colorClasses[color],
  leadingClasses[actualLeading],
  align ? alignClasses[align] : '',
  truncateClass,
  lineClampClass,
  prose ? 'text-prose' : '',
  className,
].filter(Boolean).join(' ');
---

<Element class={classes}>
  <slot />
</Element>

<style is:global>
  /**
   * Text/Body typography styles
   * Using CSS custom properties from tokens.css
   */

  /* Font family */
  .font-body {
    font-family: var(--font-family-body);
  }

  /* Body text sizes */
  .text-body-xs {
    font-size: var(--font-size-xs);
  }
  .text-body-sm {
    font-size: var(--font-size-sm);
  }
  .text-body-base {
    font-size: var(--font-size-base);
  }
  .text-body-lg {
    font-size: var(--font-size-lg);
  }
  .text-body-xl {
    font-size: var(--font-size-2xl);
  }

  /* Line heights */
  .leading-snug {
    line-height: var(--line-height-snug);
  }
  .leading-normal {
    line-height: var(--line-height-normal);
  }
  .leading-relaxed {
    line-height: var(--line-height-relaxed);
  }
  .leading-loose {
    line-height: var(--line-height-loose);
  }

  /* Text colors for body */
  .text-body-primary {
    color: var(--color-text-primary);
  }
  .text-body-secondary {
    color: var(--color-text-secondary);
  }
  .text-body-tertiary {
    color: var(--color-text-tertiary);
  }
  .text-body-inverse {
    color: var(--color-text-inverse);
  }
  .text-body-accent {
    color: var(--color-accent-600);
  }
  .text-body-emergency {
    color: var(--color-emergency-600);
  }
  .text-body-success {
    color: var(--color-success-600);
  }
  .text-inherit {
    color: inherit;
  }

  /* Alignment */
  .text-left {
    text-align: left;
  }
  .text-center {
    text-align: center;
  }
  .text-right {
    text-align: right;
  }
  .text-justify {
    text-align: justify;
  }

  /* Truncation - single line */
  .truncate-text {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Line clamp for multi-line truncation */
  .line-clamp-1,
  .line-clamp-2,
  .line-clamp-3,
  .line-clamp-4,
  .line-clamp-5 {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .line-clamp-1 { -webkit-line-clamp: 1; }
  .line-clamp-2 { -webkit-line-clamp: 2; }
  .line-clamp-3 { -webkit-line-clamp: 3; }
  .line-clamp-4 { -webkit-line-clamp: 4; }
  .line-clamp-5 { -webkit-line-clamp: 5; }

  /* Prose styling for rich text content */
  .text-prose {
    max-width: 65ch;
  }

  .text-prose p + p {
    margin-top: var(--space-4);
  }

  .text-prose a {
    color: var(--color-text-link);
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
    transition: color var(--duration-fast) var(--ease-default);
  }

  .text-prose a:hover {
    color: var(--color-text-link-hover);
  }

  .text-prose strong {
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
  }

  .text-prose em {
    font-style: italic;
  }

  .text-prose ul,
  .text-prose ol {
    margin-top: var(--space-4);
    margin-bottom: var(--space-4);
    padding-left: var(--space-6);
  }

  .text-prose ul {
    list-style-type: disc;
  }

  .text-prose ol {
    list-style-type: decimal;
  }

  .text-prose li {
    margin-top: var(--space-2);
  }

  .text-prose li::marker {
    color: var(--color-primary-500);
  }

  /* Dark mode / inverse section support */
  .section-inverse .text-body-primary,
  [data-theme="dark"] .text-body-primary {
    color: var(--color-text-inverse);
  }

  .section-inverse .text-body-secondary,
  [data-theme="dark"] .text-body-secondary {
    color: rgba(248, 250, 252, 0.7);
  }
</style>
