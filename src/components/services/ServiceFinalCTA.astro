---
/**
 * ServiceFinalCTA - Strong closing conversion section
 *
 * Styled to match service type (consistent with hero):
 * - installation: Blue gradient
 * - repair: Red/orange emergency
 * - maintenance: Teal/green
 */

import Section from '../primitives/Section.astro';
import { getBusinessProfile } from '../../lib/getBusinessProfile';

interface Props {
  serviceTitle: string;
  serviceType: 'installation' | 'repair' | 'maintenance';
  location?: {
    title: string;
  };
}

const { serviceTitle, serviceType, location } = Astro.props;
const profile = await getBusinessProfile();

// Generate SEO-optimized headline with service keyword
const headline = location
  ? `Ready for ${serviceTitle} in ${location.title}?`
  : `Ready for ${serviceTitle}?`;

// Supporting copy based on service type
const supportingCopy = {
  installation: `Free estimates, no pressure. Get expert advice from TSSA-certified technicians who've served Ontario families for ${new Date().getFullYear() - profile.business.established_year}+ years.`,
  repair: `Don't wait for the problem to get worse. Our technicians are available 24/7 with no overtime charges.`,
  maintenance: `Keep your system running at peak efficiency. Prevent costly breakdowns with regular professional maintenance.`,
};

// Style variants matching hero
const styleVariants = {
  installation: {
    gradient: 'bg-gradient-to-r from-brand-blue to-brand-blue-dark',
    primaryBtnBg: 'bg-white text-brand-blue hover:bg-gray-100',
    secondaryBtnBorder: 'border-white text-white hover:bg-white hover:text-brand-blue',
  },
  repair: {
    gradient: 'bg-gradient-to-r from-red-600 to-orange-500',
    primaryBtnBg: 'bg-white text-red-600 hover:bg-gray-100',
    secondaryBtnBorder: 'border-white text-white hover:bg-white hover:text-red-600',
  },
  maintenance: {
    gradient: 'bg-gradient-to-r from-teal-600 to-emerald-500',
    primaryBtnBg: 'bg-white text-teal-600 hover:bg-gray-100',
    secondaryBtnBorder: 'border-white text-white hover:bg-white hover:text-teal-600',
  },
};

const styles = styleVariants[serviceType];
---

<Section variant="default">
  <div class={`overflow-hidden rounded-2xl ${styles.gradient}`}>
    <div class="px-6 py-12 text-center sm:px-10 sm:py-16">
      {/* SEO-Optimized H2 */}
      <h2 class="section-title mx-auto mb-4 max-w-3xl text-white">
        {headline}
      </h2>

      {/* Supporting Copy */}
      <p class="mx-auto mb-8 max-w-2xl text-base text-white/90 sm:text-lg">
        {supportingCopy[serviceType]}
      </p>

      {/* CTAs */}
      <div class="flex flex-col items-center gap-4 sm:flex-row sm:justify-center">
        {/* Primary: Call */}
        <a
          href={`tel:${profile.contact.phone_e164}`}
          class={`group inline-flex w-full items-center justify-center gap-2 rounded-full px-8 py-4 font-bold shadow-xl transition-all hover:scale-105 hover:shadow-2xl sm:w-auto ${styles.primaryBtnBg}`}
          data-cta-context={`service-final-${serviceType}`}
        >
          <svg class="h-5 w-5 transition-transform group-hover:rotate-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
          </svg>
          <span>{serviceType === 'repair' ? 'Call Now - 24/7' : `Call ${profile.contact.phone_display}`}</span>
        </a>

        {/* Secondary: Book */}
        {profile.contact.booking.enabled && (
          <a
            href={profile.contact.booking.url}
            target="_blank"
            rel="noopener noreferrer"
            class={`group inline-flex w-full items-center justify-center gap-2 rounded-full border-2 bg-transparent px-8 py-4 font-bold transition-all sm:w-auto ${styles.secondaryBtnBorder}`}
            data-cta-context={`service-final-${serviceType}`}
          >
            <span>{serviceType === 'repair' ? 'Book Non-Emergency' : 'Book Free Estimate'}</span>
            <svg class="h-5 w-5 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>
        )}
      </div>
    </div>
  </div>
</Section>
