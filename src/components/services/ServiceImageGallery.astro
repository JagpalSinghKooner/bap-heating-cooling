---
/**
 * ServiceImageGallery - Image gallery section
 *
 * Shows real work examples (placeholder images for now).
 * Responsive grid with optional captions.
 */

import Section from '../primitives/Section.astro';

interface ServiceImage {
  src: string;
  alt: string;
  caption?: string;
}

interface Props {
  serviceTitle: string;
  images: ServiceImage[];
}

const { serviceTitle, images } = Astro.props;
---

{images && images.length > 0 && (
  <Section variant="muted">
    {/* Header */}
    <div class="mb-10 text-center">
      <p class="eyebrow mb-3">Our Work</p>
      <h2 class="section-title mx-auto mb-4 max-w-3xl">
        {serviceTitle} Gallery
      </h2>
      <p class="mx-auto max-w-2xl text-base text-muted-foreground">
        See examples of our {serviceTitle.toLowerCase()} work for Ontario homeowners.
      </p>
    </div>

    {/* Image Grid */}
    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {images.map((image) => (
        <figure class="group relative overflow-hidden rounded-xl border border-border bg-muted">
          {/* Image with aspect ratio */}
          <div class="aspect-[4/3] overflow-hidden bg-muted">
            <img
              src={image.src}
              alt={image.alt}
              loading="lazy"
              class="gallery-image h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
            />
          </div>

          {/* Caption */}
          {image.caption && (
            <figcaption class="p-4">
              <p class="text-sm text-muted-foreground">{image.caption}</p>
            </figcaption>
          )}

          {/* Hover overlay with alt text for context */}
          <div class="pointer-events-none absolute inset-0 flex items-end bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100">
            <p class="p-4 text-sm font-medium text-white">{image.alt}</p>
          </div>
        </figure>
      ))}
    </div>

    {/* Footer note */}
    <div class="mt-8 text-center">
      <p class="text-sm text-muted-foreground">
        All installations performed by TSSA-certified technicians
      </p>
    </div>
  </Section>
)}

<script>
  // Handle image load errors with placeholder
  document.querySelectorAll('.gallery-image').forEach((img) => {
    (img as HTMLImageElement).addEventListener('error', (e) => {
      const target = e.target as HTMLImageElement;
      const parent = target.parentElement;
      if (parent) {
        parent.innerHTML = `
          <div class="flex h-full w-full items-center justify-center bg-muted">
            <svg class="h-12 w-12 text-muted-foreground/30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
          </div>
        `;
      }
    });
  });
</script>
