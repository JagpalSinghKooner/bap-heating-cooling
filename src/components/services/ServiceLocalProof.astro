---
/**
 * ServiceLocalProof Component
 *
 * Displays location-specific social proof on service-city pages.
 * This is the moment where a visitor from Guelph sees "Yes, they've
 * helped people exactly like me, right here in my neighborhood."
 *
 * Design Philosophy:
 * Local proof is the ultimate trust signal. When someone searching
 * "furnace repair Guelph" sees a testimonial from a Guelph homeowner,
 * the psychological distance closes instantly. We design this section
 * to feel like a proud moment - a neighbor sharing their experience.
 *
 * Visual Direction:
 * Warm, authentic, slightly elevated. The testimonial card floats
 * against a textured background with a subtle map/location motif.
 * The optional result stat creates a "proof point" that validates
 * the emotional testimonial with hard data.
 *
 * Features:
 * - Location-aware headline that mentions the city
 * - Featured testimonial with quote styling
 * - Avatar with customer initials
 * - Location pin indicator for hyper-local feel
 * - Optional result stat with animated counter effect
 * - Decorative map/geo pattern for visual interest
 *
 * @example
 * <ServiceLocalProof
 *   localProof={{
 *     testimonial: "B.A.P saved us when our furnace died on the coldest night...",
 *     customerName: "Jennifer & Mark T.",
 *     customerLocation: "Guelph",
 *     result: "Restored heat in under 2 hours"
 *   }}
 *   locationTitle="Guelph"
 * />
 */

import Section from '../primitives/Section.astro';
import Container from '../primitives/Container.astro';
import Avatar from '../primitives/Avatar.astro';

interface LocalProofData {
  /** The customer testimonial text */
  testimonial: string;
  /** Customer's name (can include last initial, e.g., "Jennifer & Mark T.") */
  customerName: string;
  /** Customer's location (city name) */
  customerLocation: string;
  /** Optional measurable result or outcome */
  result?: string;
}

interface Props {
  /** Local proof data object from service-city content */
  localProof: LocalProofData;
  /** Location title for the section headline */
  locationTitle: string;
  /** Section ID for anchor links */
  id?: string;
  /** Additional CSS classes */
  class?: string;
}

const {
  localProof,
  locationTitle,
  id = 'local-proof',
  class: className = '',
} = Astro.props;

// Generate the location-aware headline
const headline = `Trusted by ${locationTitle} Homeowners`;
const subheadline = `Real results from your neighbors in ${locationTitle}`;

// Build class string
const sectionClasses = [
  'service-local-proof',
  className,
].filter(Boolean).join(' ');
---

<Section
  variant="default"
  padding="lg"
  id={id}
  class={sectionClasses}
>
  {/* Decorative Background Pattern */}
  <div class="local-proof-bg" aria-hidden="true">
    <div class="local-proof-bg-pattern"></div>
    <div class="local-proof-bg-gradient"></div>
  </div>

  <Container size="lg">
    <div class="local-proof-content">
      {/* Location Badge */}
      <div class="local-proof-location-badge">
        <svg class="local-proof-pin-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
        </svg>
        <span class="local-proof-location-text">{locationTitle}, Ontario</span>
      </div>

      {/* Section Header */}
      <header class="local-proof-header">
        <h2 class="local-proof-headline">{headline}</h2>
        <p class="local-proof-subheadline">{subheadline}</p>
      </header>

      {/* Main Content Grid */}
      <div class="local-proof-grid">
        {/* Testimonial Card */}
        <article class="local-proof-card">
          {/* Quote Mark */}
          <div class="local-proof-quote-mark" aria-hidden="true">
            <svg viewBox="0 0 32 32" fill="currentColor">
              <path d="M10 8c-3.3 0-6 2.7-6 6v10h10V14H6c0-2.2 1.8-4 4-4V8zm14 0c-3.3 0-6 2.7-6 6v10h10V14h-8c0-2.2 1.8-4 4-4V8z"/>
            </svg>
          </div>

          {/* Testimonial Content */}
          <blockquote class="local-proof-testimonial">
            <p>{localProof.testimonial}</p>
          </blockquote>

          {/* Customer Attribution */}
          <footer class="local-proof-attribution">
            <Avatar
              alt={localProof.customerName}
              fallback={localProof.customerName}
              size="lg"
              variant="primary"
            />
            <div class="local-proof-author">
              <span class="local-proof-author-name">
                {localProof.customerName}
                <svg class="local-proof-verified-icon" viewBox="0 0 20 20" fill="currentColor" aria-label="Verified Customer">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                </svg>
              </span>
              <span class="local-proof-author-location">
                <svg class="local-proof-mini-pin" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M8 1.5a4.5 4.5 0 00-4.5 4.5c0 2.233 1.26 4.018 2.53 5.328a15.89 15.89 0 001.97 1.672l.152.106.152-.106a15.89 15.89 0 001.97-1.672C11.74 10.018 13 8.233 13 6A4.5 4.5 0 008 1.5zM8 8.5a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                </svg>
                {localProof.customerLocation}, ON
              </span>
            </div>
          </footer>
        </article>

        {/* Result Stat (if provided) */}
        {localProof.result && (
          <div class="local-proof-result">
            <div class="local-proof-result-card">
              <div class="local-proof-result-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
              </div>
              <div class="local-proof-result-content">
                <span class="local-proof-result-label">The Result</span>
                <span class="local-proof-result-value">{localProof.result}</span>
              </div>
            </div>
          </div>
        )}
      </div>

      {/* Trust Indicator Row */}
      <div class="local-proof-trust-row">
        <div class="local-proof-trust-item">
          <svg viewBox="0 0 20 20" fill="currentColor" class="local-proof-trust-icon">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
          </svg>
          <span>5-Star Service</span>
        </div>
        <div class="local-proof-trust-divider" aria-hidden="true"></div>
        <div class="local-proof-trust-item">
          <svg viewBox="0 0 20 20" fill="currentColor" class="local-proof-trust-icon">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
          </svg>
          <span>Verified Customer</span>
        </div>
        <div class="local-proof-trust-divider" aria-hidden="true"></div>
        <div class="local-proof-trust-item">
          <svg viewBox="0 0 20 20" fill="currentColor" class="local-proof-trust-icon">
            <path fill-rule="evenodd" d="M10 1.944A9.953 9.953 0 005.172 4.172a10.002 10.002 0 009.656 9.656 9.953 9.953 0 002.228-4.828L10 1.944zM4.243 5.243a8 8 0 1111.314 11.314A8 8 0 014.243 5.243z" clip-rule="evenodd"/>
            <path d="M10 6a.75.75 0 01.75.75v3.25h2.5a.75.75 0 010 1.5h-3.25a.75.75 0 01-.75-.75v-4a.75.75 0 01.75-.75z"/>
          </svg>
          <span>Local to {locationTitle}</span>
        </div>
      </div>
    </div>
  </Container>
</Section>

<style>
  /**
   * ServiceLocalProof Component Styles
   * Warm, authentic local proof with geographic visual motifs
   */

  /* ============================================
     SECTION STRUCTURE
     ============================================ */

  .service-local-proof {
    position: relative;
    overflow: hidden;
  }

  /* ============================================
     DECORATIVE BACKGROUND
     Subtle map/topographic pattern for "local" feel
     ============================================ */

  .local-proof-bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 0;
  }

  /* Topographic/contour line pattern */
  .local-proof-bg-pattern {
    position: absolute;
    inset: 0;
    opacity: 0.03;
    background-image:
      repeating-radial-gradient(
        circle at 50% 50%,
        transparent 0,
        transparent 40px,
        var(--color-primary-600) 41px,
        var(--color-primary-600) 42px,
        transparent 43px
      );
    background-size: 120px 120px;
  }

  /* Warm gradient overlay */
  .local-proof-bg-gradient {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      180deg,
      var(--color-surface-warm) 0%,
      var(--color-surface-primary) 40%,
      var(--color-surface-secondary) 100%
    );
    opacity: 0.9;
  }

  /* ============================================
     CONTENT WRAPPER
     ============================================ */

  .local-proof-content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-8);
  }

  /* ============================================
     LOCATION BADGE
     Prominent city indicator at top
     ============================================ */

  .local-proof-location-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    background: linear-gradient(
      135deg,
      var(--color-primary-50) 0%,
      var(--color-primary-100) 100%
    );
    border: 1px solid var(--color-primary-200);
    border-radius: var(--radius-full);
    color: var(--color-primary-700);
    font-family: var(--font-family-heading);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    letter-spacing: var(--letter-spacing-wide);
  }

  .local-proof-pin-icon {
    width: 18px;
    height: 18px;
    color: var(--color-primary-600);
  }

  .local-proof-location-text {
    text-transform: uppercase;
  }

  /* ============================================
     SECTION HEADER
     ============================================ */

  .local-proof-header {
    text-align: center;
    max-width: 600px;
  }

  .local-proof-headline {
    margin: 0;
    font-family: var(--font-family-heading);
    font-size: var(--font-size-5xl);
    font-weight: var(--font-weight-bold);
    letter-spacing: var(--letter-spacing-tight);
    color: var(--color-text-primary);
    line-height: var(--line-height-tight);
  }

  .local-proof-subheadline {
    margin: var(--space-3) 0 0;
    font-family: var(--font-family-body);
    font-size: var(--font-size-lg);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
  }

  /* ============================================
     MAIN GRID
     Testimonial card with optional result
     ============================================ */

  .local-proof-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-6);
    width: 100%;
    max-width: 800px;
  }

  @media (min-width: 768px) {
    .local-proof-grid {
      grid-template-columns: 2fr 1fr;
      gap: var(--space-8);
      align-items: stretch;
    }

    .local-proof-grid:not(:has(.local-proof-result)) {
      grid-template-columns: 1fr;
      max-width: 680px;
    }
  }

  /* ============================================
     TESTIMONIAL CARD
     Featured quote with warm styling
     ============================================ */

  .local-proof-card {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
    padding: var(--space-8);
    background: linear-gradient(
      145deg,
      var(--color-surface-primary) 0%,
      var(--color-surface-warm) 100%
    );
    border: 1px solid var(--color-border-primary);
    border-radius: var(--radius-2xl);
    box-shadow:
      var(--shadow-lg),
      0 0 0 1px rgba(255, 255, 255, 0.8) inset;
  }

  /* Quote mark decoration */
  .local-proof-quote-mark {
    position: absolute;
    top: var(--space-6);
    right: var(--space-6);
    width: 48px;
    height: 48px;
    color: var(--color-primary-200);
    opacity: 0.6;
    pointer-events: none;
  }

  @media (min-width: 768px) {
    .local-proof-quote-mark {
      width: 64px;
      height: 64px;
    }
  }

  /* Testimonial text */
  .local-proof-testimonial {
    margin: 0;
    position: relative;
    z-index: 1;
    padding-right: var(--space-10);
  }

  .local-proof-testimonial p {
    margin: 0;
    font-family: var(--font-family-body);
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-normal);
    font-style: italic;
    color: var(--color-text-primary);
    line-height: var(--line-height-relaxed);
  }

  /* Customer attribution */
  .local-proof-attribution {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding-top: var(--space-4);
    border-top: 1px solid var(--color-border-secondary);
    margin-top: auto;
  }

  .local-proof-author {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .local-proof-author-name {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1-5);
    font-family: var(--font-family-heading);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
  }

  .local-proof-verified-icon {
    width: 18px;
    height: 18px;
    color: var(--color-success-500);
    flex-shrink: 0;
  }

  .local-proof-author-location {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    font-family: var(--font-family-body);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
  }

  .local-proof-mini-pin {
    width: 14px;
    height: 14px;
    color: var(--color-primary-500);
    flex-shrink: 0;
  }

  /* ============================================
     RESULT CARD
     Proof point that validates the testimonial
     ============================================ */

  .local-proof-result {
    display: flex;
    align-items: stretch;
  }

  .local-proof-result-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    width: 100%;
    padding: var(--space-6);
    background: linear-gradient(
      135deg,
      var(--color-primary-600) 0%,
      var(--color-primary-700) 100%
    );
    border-radius: var(--radius-2xl);
    text-align: center;
    box-shadow:
      var(--shadow-lg),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .local-proof-result-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 56px;
    height: 56px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-full);
    color: white;
  }

  .local-proof-result-icon svg {
    width: 28px;
    height: 28px;
  }

  .local-proof-result-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .local-proof-result-label {
    font-family: var(--font-family-heading);
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-semibold);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-widest);
    color: var(--color-primary-200);
  }

  .local-proof-result-value {
    font-family: var(--font-family-heading);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    color: white;
    line-height: var(--line-height-snug);
  }

  @media (min-width: 768px) {
    .local-proof-result-icon {
      width: 64px;
      height: 64px;
    }

    .local-proof-result-icon svg {
      width: 32px;
      height: 32px;
    }

    .local-proof-result-value {
      font-size: var(--font-size-xl);
    }
  }

  /* ============================================
     TRUST INDICATOR ROW
     Additional credibility signals
     ============================================ */

  .local-proof-trust-row {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    padding: var(--space-4) var(--space-6);
    background-color: var(--color-surface-tertiary);
    border-radius: var(--radius-full);
  }

  .local-proof-trust-item {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-family: var(--font-family-body);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-secondary);
    white-space: nowrap;
  }

  .local-proof-trust-icon {
    width: 18px;
    height: 18px;
    color: var(--color-primary-500);
    flex-shrink: 0;
  }

  .local-proof-trust-item:first-child .local-proof-trust-icon {
    color: var(--color-warning-500);
  }

  .local-proof-trust-item:nth-child(3) .local-proof-trust-icon {
    color: var(--color-success-500);
  }

  .local-proof-trust-divider {
    width: 1px;
    height: 16px;
    background-color: var(--color-border-primary);
  }

  @media (max-width: 640px) {
    .local-proof-trust-row {
      flex-direction: column;
      border-radius: var(--radius-xl);
      gap: var(--space-3);
    }

    .local-proof-trust-divider {
      display: none;
    }
  }

  /* ============================================
     RESPONSIVE ADJUSTMENTS
     ============================================ */

  @media (max-width: 768px) {
    .local-proof-content {
      gap: var(--space-6);
    }

    .local-proof-headline {
      font-size: var(--font-size-4xl);
    }

    .local-proof-card {
      padding: var(--space-6);
    }

    .local-proof-testimonial p {
      font-size: var(--font-size-lg);
    }
  }

  /* ============================================
     ANIMATION: Fade-in on scroll
     ============================================ */

  @media (prefers-reduced-motion: no-preference) {
    .local-proof-card,
    .local-proof-result-card {
      animation: localProofFadeUp 0.6s var(--ease-out) forwards;
      animation-delay: 0.2s;
      opacity: 0;
    }

    .local-proof-result-card {
      animation-delay: 0.35s;
    }

    @keyframes localProofFadeUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .local-proof-card,
    .local-proof-result-card {
      opacity: 1;
      animation: none;
    }
  }
</style>
