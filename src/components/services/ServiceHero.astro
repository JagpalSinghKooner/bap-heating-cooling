---
/**
 * ServiceHero - Conversion-optimized hero for service pages
 *
 * Three variants based on serviceType:
 * - installation: Blue gradient, booking-focused CTAs
 * - repair: Red/orange emergency, 24/7 phone-focused
 * - maintenance: Green/teal professional, scheduled service focused
 */

import { getBusinessProfile } from '../../lib/getBusinessProfile';
import Button from '../primitives/Button.astro';

interface Props {
  title: string;
  description: string;
  category: string;
  serviceType: 'installation' | 'repair' | 'maintenance';
  location?: {
    title: string;
    slug: string;
  };
}

const { title, description, category, serviceType, location } = Astro.props;
const profile = await getBusinessProfile();

// Generate SEO-optimized H1 based on service type and location
function generateH1(): string {
  const locationSuffix = location ? ` in ${location.title}, Ontario` : ' Services in Ontario';

  if (serviceType === 'repair') {
    return `24/7 Emergency ${title}${locationSuffix}`;
  } else if (serviceType === 'maintenance') {
    return `Professional ${title}${locationSuffix}`;
  } else {
    // installation
    return `${title}${locationSuffix} | TSSA-Certified`;
  }
}

// Generate supporting tagline
function generateTagline(): string {
  if (serviceType === 'repair') {
    return `Technician at your door typically within ${profile.hours.target_response_time_minutes} minutes. No overtime charges.`;
  } else if (serviceType === 'maintenance') {
    return `Keep your system running efficiently. Extend equipment life and prevent costly breakdowns.`;
  } else {
    return description;
  }
}

// Category display names
const categoryLabels: Record<string, string> = {
  heating: 'Heating Services',
  cooling: 'Cooling Services',
  iaq: 'Indoor Air Quality',
  'water-heating': 'Water Heating',
  commercial: 'Commercial HVAC',
  plans: 'Maintenance Plans',
};

const categoryLabel = categoryLabels[category] || 'HVAC Services';

// Style variants
const styleVariants = {
  installation: {
    gradient: 'bg-gradient-to-r from-brand-blue to-brand-blue-dark',
    badge: 'bg-white/20 text-white',
    textColor: 'text-white',
    subtextColor: 'text-white/90',
    primaryBtn: 'emergency',
    secondaryBtn: 'outline',
  },
  repair: {
    gradient: 'bg-gradient-to-r from-red-600 to-orange-500',
    badge: 'bg-white/20 text-white',
    textColor: 'text-white',
    subtextColor: 'text-white/90',
    primaryBtn: 'default',
    secondaryBtn: 'outline',
  },
  maintenance: {
    gradient: 'bg-gradient-to-r from-teal-600 to-emerald-500',
    badge: 'bg-white/20 text-white',
    textColor: 'text-white',
    subtextColor: 'text-white/90',
    primaryBtn: 'emergency',
    secondaryBtn: 'outline',
  },
};

const styles = styleVariants[serviceType];
const h1Text = generateH1();
const tagline = generateTagline();
---

<section class={`relative overflow-hidden ${styles.gradient}`}>
  <!-- Content -->
  <div class="relative z-10 mx-auto max-w-7xl px-4 py-12 sm:px-6 sm:py-16 lg:px-8 lg:py-20">
    <div class="mx-auto max-w-4xl text-center">

      {/* Eyebrow Badge */}
      {serviceType === 'repair' ? (
        <div class={`mb-4 inline-flex items-center gap-2 rounded-full ${styles.badge} px-4 py-2 text-sm font-bold uppercase tracking-wide backdrop-blur-sm`}>
          <span class="relative flex h-3 w-3">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span>
            <span class="relative inline-flex rounded-full h-3 w-3 bg-white"></span>
          </span>
          <span>24/7 Emergency Service</span>
        </div>
      ) : serviceType === 'maintenance' ? (
        <div class={`mb-4 inline-flex items-center gap-2 rounded-full ${styles.badge} px-4 py-2 text-sm font-bold uppercase tracking-wide backdrop-blur-sm`}>
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>Preventive Maintenance</span>
        </div>
      ) : (
        <div class={`mb-4 inline-flex items-center gap-2 rounded-full ${styles.badge} px-4 py-2 text-sm font-bold uppercase tracking-wide backdrop-blur-sm`}>
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
          <span>{categoryLabel}</span>
        </div>
      )}

      {/* SEO-Optimized H1 */}
      <h1 class={`mb-4 text-3xl font-extrabold leading-tight ${styles.textColor} sm:text-4xl md:text-5xl`}>
        {h1Text}
      </h1>

      {/* Tagline */}
      <p class={`mb-8 text-base leading-relaxed ${styles.subtextColor} sm:text-lg md:text-xl max-w-3xl mx-auto`}>
        {tagline}
      </p>

      {/* CTAs - Different layouts based on service type */}
      {serviceType === 'repair' ? (
        <!-- Repair: Large phone CTA prominent -->
        <div class="mb-8">
          <a
            href={`tel:${profile.contact.phone_e164}`}
            data-cta="emergency"
            data-cta-context="service-hero-repair"
            class="group inline-flex items-center gap-3 rounded-full bg-white px-8 py-5 text-red-600 shadow-2xl transition-all hover:scale-105 hover:shadow-3xl"
          >
            <span class="flex h-12 w-12 items-center justify-center rounded-full bg-red-600 text-white group-hover:animate-pulse">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
            </span>
            <span class="flex flex-col text-left">
              <span class="text-sm font-medium text-gray-600">Call Now - 24/7</span>
              <span class="text-2xl font-bold sm:text-3xl">{profile.contact.phone_display}</span>
            </span>
          </a>

          {profile.contact.booking.enabled && (
            <div class="mt-4">
              <a
                href={profile.contact.booking.url}
                target="_blank"
                rel="noopener noreferrer"
                data-cta-context="service-hero-repair"
                class="inline-flex items-center gap-2 text-white/90 underline underline-offset-4 transition-colors hover:text-white"
              >
                <span>Or book online for non-emergencies</span>
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
              </a>
            </div>
          )}
        </div>
      ) : (
        <!-- Installation/Maintenance: Two equal CTAs -->
        <div class="mb-10 flex flex-col items-center justify-center gap-4 sm:flex-row">
          <Button
            variant="emergency"
            size="lg"
            href={`tel:${profile.contact.phone_e164}`}
            data-cta-context={`service-hero-${serviceType}`}
            class="group w-full rounded-full shadow-2xl transition-all hover:scale-105 hover:shadow-3xl sm:w-auto"
          >
            <svg class="h-6 w-6 transition-transform group-hover:rotate-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            <span class="font-bold">Call {profile.contact.phone_display}</span>
          </Button>

          {profile.contact.booking.enabled && (
            <Button
              variant="outline"
              size="lg"
              href={profile.contact.booking.url}
              target="_blank"
              rel="noopener noreferrer"
              data-cta-context={`service-hero-${serviceType}`}
              class="group w-full rounded-full border-2 border-white bg-white/10 text-white backdrop-blur-sm transition-all hover:bg-white hover:text-brand-blue sm:w-auto"
            >
              <span class="font-semibold">Book Free Estimate</span>
              <svg class="h-5 w-5 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </Button>
          )}
        </div>
      )}

      {/* Availability Indicator - Only for installation/maintenance */}
      {serviceType !== 'repair' && (
        <div class="mb-6 flex items-center justify-center">
          <div class="inline-flex items-center gap-2 rounded-full bg-white/10 px-4 py-2.5 backdrop-blur-sm">
            <svg class="h-5 w-5 flex-shrink-0 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span id="service-availability-text" class={`text-sm font-semibold ${styles.textColor}`}>
              Loading availability...
            </span>
          </div>
        </div>
      )}

      {/* Trust Indicators */}
      <div class={`flex flex-wrap items-center justify-center gap-4 text-sm ${styles.subtextColor} sm:gap-6 sm:text-base`}>
        {serviceType === 'repair' ? (
          <>
            <span class="flex items-center gap-1.5">
              <svg class="h-4 w-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
              No Overtime Charges
            </span>
            <span class="flex items-center gap-1.5">
              <svg class="h-4 w-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
              Upfront Pricing
            </span>
            <span class="flex items-center gap-1.5">
              <svg class="h-4 w-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
              Fixed Right Guarantee
            </span>
          </>
        ) : (
          <>
            <span class="flex items-center gap-1.5">
              <svg class="h-4 w-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
              Licensed & Insured
            </span>
            <span class="flex items-center gap-1.5">
              <svg class="h-4 w-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
              TSSA Certified
            </span>
            <span class="flex items-center gap-1.5">
              <svg class="h-4 w-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
              {serviceType === 'maintenance' ? 'Preventive Care' : '10-Year Warranty'}
            </span>
          </>
        )}
      </div>
    </div>
  </div>

  {/* Background Pattern for Repair */}
  {serviceType === 'repair' && (
    <div class="absolute inset-0 opacity-10" aria-hidden="true">
      <div class="absolute inset-0 bg-diagonal-stripes" />
    </div>
  )}
</section>

<script>
  // Dynamic availability indicator (reused from homepage Hero)
  function updateServiceAvailability() {
    const availabilityEl = document.getElementById('service-availability-text');
    if (!availabilityEl) return;

    const now = new Date();
    const currentHour = now.getHours();
    const currentDay = now.getDay();

    let nextAvailable = '';

    const isWeekday = currentDay >= 1 && currentDay <= 5;
    const isSaturday = currentDay === 6;
    const isSunday = currentDay === 0;

    if (isSunday) {
      nextAvailable = 'Monday 8:00 AM';
    } else if (isSaturday) {
      if (currentHour < 9) {
        nextAvailable = 'Today 9:00 AM';
      } else if (currentHour < 16) {
        const nextSlot = Math.ceil((currentHour + 1) / 2) * 2;
        if (nextSlot <= 16) {
          nextAvailable = `Today ${nextSlot > 12 ? nextSlot - 12 : nextSlot}:00 ${nextSlot >= 12 ? 'PM' : 'AM'}`;
        } else {
          nextAvailable = 'Monday 8:00 AM';
        }
      } else {
        nextAvailable = 'Monday 8:00 AM';
      }
    } else if (isWeekday) {
      if (currentHour < 8) {
        nextAvailable = 'Today 8:00 AM';
      } else if (currentHour < 18) {
        const nextSlot = Math.ceil((currentHour + 1) / 2) * 2;
        if (nextSlot <= 18) {
          nextAvailable = `Today ${nextSlot > 12 ? nextSlot - 12 : nextSlot}:00 ${nextSlot >= 12 ? 'PM' : 'AM'}`;
        } else {
          if (currentDay === 5) {
            nextAvailable = 'Monday 8:00 AM';
          } else {
            nextAvailable = 'Tomorrow 8:00 AM';
          }
        }
      } else {
        if (currentDay === 5) {
          nextAvailable = 'Monday 8:00 AM';
        } else {
          nextAvailable = 'Tomorrow 8:00 AM';
        }
      }
    }

    availabilityEl.innerHTML = `<span class="text-green-400 font-bold">‚óè</span> Next available: ${nextAvailable}`;
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateServiceAvailability);
  } else {
    updateServiceAvailability();
  }
</script>
