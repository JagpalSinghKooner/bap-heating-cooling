---
/**
 * GradientCTASection - Consolidated CTA component
 *
 * Replaces:
 * - EmergencyCTASection (emergency variant)
 * - FinalCTASection (primary variant)
 * - ServiceFinalCTA (installation/repair/maintenance variants)
 *
 * Styling matches original components per service type:
 * - emergency: Red/orange gradient, full-width, badge, large phone button
 * - primary: Brand blue gradient, card layout
 * - installation: Brand blue gradient, card layout
 * - repair: Red/orange gradient, card layout
 * - maintenance: Teal/green gradient, card layout
 */

import Section from '../primitives/Section.astro';
import Badge from '../primitives/Badge.astro';
import { getBusinessProfile } from '../../lib/getBusinessProfile';

interface Props {
  headline: string;
  description: string;
  variant: 'emergency' | 'primary' | 'installation' | 'repair' | 'maintenance';
  context?: string;
  // Emergency variant specific props
  badgeText?: string;
  responseTime?: string;
  // Optional overrides (defaults from business profile)
  phoneNumber?: string;
  phoneDisplay?: string;
  bookingUrl?: string;
  bookingEnabled?: boolean;
}

const {
  headline,
  description,
  variant,
  context = `cta-${variant}`,
  badgeText = '24/7 Emergency Service',
  responseTime,
  phoneNumber: phoneNumberOverride,
  phoneDisplay: phoneDisplayOverride,
  bookingUrl: bookingUrlOverride,
  bookingEnabled: bookingEnabledOverride,
} = Astro.props;

const profile = await getBusinessProfile();

// Use overrides or defaults from business profile
const phoneNumber = phoneNumberOverride || profile.contact.phone_e164;
const phoneDisplay = phoneDisplayOverride || profile.contact.phone_display;
const bookingUrl = bookingUrlOverride || profile.contact.booking.url;
const bookingEnabled = bookingEnabledOverride ?? profile.contact.booking.enabled;

// Gradient and color configurations matching existing components
const styleConfig = {
  emergency: {
    gradient: 'bg-gradient-to-r from-red-600 to-orange-500',
    primaryBtnBg: 'bg-white text-red-600 hover:bg-gray-100',
    primaryBtnText: 'text-red-600',
    secondaryBtnBorder: 'border-white text-white hover:bg-white hover:text-red-600',
    iconBg: 'bg-red-600',
    fullWidth: true,
  },
  primary: {
    gradient: 'bg-gradient-to-r from-brand-blue to-brand-blue-dark',
    primaryBtnBg: 'bg-white text-brand-blue hover:bg-gray-100',
    primaryBtnText: 'text-brand-blue',
    secondaryBtnBorder: 'border-white text-white hover:bg-white hover:text-brand-blue',
    iconBg: 'bg-brand-blue',
    fullWidth: false,
  },
  installation: {
    gradient: 'bg-gradient-to-r from-brand-blue to-brand-blue-dark',
    primaryBtnBg: 'bg-white text-brand-blue hover:bg-gray-100',
    primaryBtnText: 'text-brand-blue',
    secondaryBtnBorder: 'border-white text-white hover:bg-white hover:text-brand-blue',
    iconBg: 'bg-brand-blue',
    fullWidth: false,
  },
  repair: {
    gradient: 'bg-gradient-to-r from-red-600 to-orange-500',
    primaryBtnBg: 'bg-white text-red-600 hover:bg-gray-100',
    primaryBtnText: 'text-red-600',
    secondaryBtnBorder: 'border-white text-white hover:bg-white hover:text-red-600',
    iconBg: 'bg-red-600',
    fullWidth: false,
  },
  maintenance: {
    gradient: 'bg-gradient-to-r from-teal-600 to-emerald-500',
    primaryBtnBg: 'bg-white text-teal-600 hover:bg-gray-100',
    primaryBtnText: 'text-teal-600',
    secondaryBtnBorder: 'border-white text-white hover:bg-white hover:text-teal-600',
    iconBg: 'bg-teal-600',
    fullWidth: false,
  },
};

const styles = styleConfig[variant];

// CTA button text based on variant
const callButtonText = variant === 'repair' ? 'Call Now - 24/7' : `Call ${phoneDisplay}`;
const bookButtonText = variant === 'repair' ? 'Book Non-Emergency' : 'Book Free Estimate';
---

{styles.fullWidth ? (
  <!-- Emergency variant: Full-width section with background pattern -->
  <section class={`relative overflow-hidden ${styles.gradient} py-14 md:py-20 lg:py-24`}>
    <div class="section-container relative z-10">
      <div class="text-center text-white">
        {/* Emergency Badge */}
        <Badge variant="default" size="md" class="mb-4 bg-white/20 text-white backdrop-blur-sm border-0">
          <span class="relative flex h-3 w-3 mr-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span>
            <span class="relative inline-flex rounded-full h-3 w-3 bg-white"></span>
          </span>
          <span>{badgeText}</span>
        </Badge>

        {/* Problem-Focused Headline */}
        <h2 class="section-title mx-auto mb-4 max-w-3xl text-white">
          {headline}
        </h2>

        {/* Response Time Guarantee (if provided) */}
        {responseTime && (
          <p class="mx-auto mb-3 max-w-2xl text-xl font-semibold text-white sm:text-2xl">
            {responseTime}
          </p>
        )}

        {/* Trust reinforcement / Description */}
        <p class="mx-auto mb-8 max-w-2xl text-base text-white/80 sm:text-lg">
          {description}
        </p>

        {/* Primary CTA - Large Phone Button */}
        <a
          href={`tel:${phoneNumber}`}
          data-cta="emergency"
          data-cta-context={context}
          class="group inline-flex items-center gap-3 rounded-full bg-white px-8 py-5 text-red-600 shadow-2xl transition-all hover:scale-105 hover:shadow-3xl"
        >
          <span class={`flex h-12 w-12 items-center justify-center rounded-full ${styles.iconBg} text-white group-hover:animate-pulse`}>
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
          </span>
          <span class="flex flex-col text-left">
            <span class="text-sm font-medium text-gray-600">Call Now - 24/7</span>
            <span class="text-2xl font-bold sm:text-3xl">{phoneDisplay}</span>
          </span>
        </a>

        {/* Secondary CTA */}
        {bookingEnabled && (
          <div class="mt-6">
            <a
              href={bookingUrl}
              target="_blank"
              rel="noopener noreferrer"
              data-cta-context={context}
              class="inline-flex items-center gap-2 text-white/90 underline underline-offset-4 transition-colors hover:text-white"
            >
              <span>Or book online for non-emergencies</span>
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
            </a>
          </div>
        )}
      </div>
    </div>

    {/* Background Pattern */}
    <div class="absolute inset-0 opacity-10" aria-hidden="true">
      <div class="absolute inset-0 bg-diagonal-stripes" />
    </div>
  </section>
) : (
  <!-- Card variant: Rounded container within Section -->
  <Section variant="default">
    <div class={`overflow-hidden rounded-2xl ${styles.gradient}`}>
      <div class="px-6 py-12 text-center sm:px-10 sm:py-16">
        <h2 class="section-title mx-auto mb-4 max-w-3xl text-white">
          {headline}
        </h2>
        <p class="mx-auto mb-8 max-w-2xl text-base text-white/90 sm:text-lg">
          {description}
        </p>
        <div class="flex flex-col items-center gap-4 sm:flex-row sm:justify-center">
          {/* Primary: Call */}
          <a
            href={`tel:${phoneNumber}`}
            class={`group inline-flex w-full items-center justify-center gap-2 rounded-full px-8 py-4 font-bold shadow-xl transition-all hover:scale-105 hover:shadow-2xl sm:w-auto ${styles.primaryBtnBg}`}
            data-cta-context={context}
          >
            <svg class="h-5 w-5 transition-transform group-hover:rotate-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            <span>{callButtonText}</span>
          </a>
          {/* Secondary: Book */}
          {bookingEnabled && (
            <a
              href={bookingUrl}
              target="_blank"
              rel="noopener noreferrer"
              class={`group inline-flex w-full items-center justify-center gap-2 rounded-full border-2 bg-transparent px-8 py-4 font-bold transition-all sm:w-auto ${styles.secondaryBtnBorder}`}
              data-cta-context={context}
            >
              <span>{bookButtonText}</span>
              <svg class="h-5 w-5 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </a>
          )}
        </div>
      </div>
    </div>
  </Section>
)}
