---
import { getBusinessProfile } from '../lib/getBusinessProfile';
import type { CTAVariant, CTAContext } from '../lib/ctaResolver';
import { getCTAConfig } from '../lib/ctaResolver';
import Button from './primitives/Button.astro';

interface Props {
  variant: CTAVariant;
  context?: CTAContext;
  class?: string;
  size?: 'default' | 'large';
}

const { variant, context = 'unknown', class: className = '', size = 'default' } = Astro.props;
const profile = await getBusinessProfile();
const ctaConfig = getCTAConfig(profile, variant);

const buttonVariant = variant === 'emergency' ? 'emergency' : 'primary';
const buttonSize = size === 'large' ? 'lg' : 'md';
---

<Button
  variant={buttonVariant}
  size={buttonSize}
  href={ctaConfig.href}
  data-cta-context={context}
  class={className}
  target={variant === 'book' ? '_blank' : undefined}
  rel={variant === 'book' ? 'noopener noreferrer' : undefined}
>
  {ctaConfig.label}
</Button>
