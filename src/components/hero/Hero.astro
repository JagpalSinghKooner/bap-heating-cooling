---
import { getBusinessProfile } from '../../lib/getBusinessProfile';
import Button from '../primitives/Button.astro';

interface Props {
  eyebrow?: string;
  headline: string;
  description?: string;
  context?: string;
}

const {
  eyebrow = 'Professional HVAC Services',
  headline,
  description,
  context = 'hero'
} = Astro.props;

const profile = await getBusinessProfile();
---

<section class="relative overflow-hidden bg-gradient-to-r from-brand-blue to-brand-blue-dark">
  <!-- Background Image with Overlay -->
  <div class="absolute inset-0 z-0">
    <img
      src="https://placehold.co/1600x900/1e40af/ffffff.png?text=."
      alt=""
      class="h-full w-full object-cover"
    />
    <!-- Gradient Overlay -->
    <div class="absolute inset-0 bg-gradient-to-r from-brand-blue/90 via-brand-blue/70 to-transparent"></div>
  </div>

  <!-- Content -->
  <div class="relative z-10 mx-auto max-w-6xl px-4 py-12 sm:px-6 sm:py-16 lg:px-8 lg:py-20">
    <div class="mx-auto max-w-4xl text-center text-white">
      <!-- Eyebrow - Enhanced Visibility -->
      {eyebrow && (
        <div class="mb-4 inline-flex items-center gap-2 rounded-full bg-white/20 px-4 py-2 text-sm font-bold uppercase tracking-wide text-white backdrop-blur-sm">
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
          <span>{eyebrow}</span>
        </div>
      )}

      <!-- Headline - Optimized -->
      <h1 class="mb-4 text-3xl font-extrabold leading-tight sm:text-4xl md:text-5xl lg:text-6xl">
        {headline}
      </h1>

      <!-- Description - Optimized -->
      {description && (
        <p class="mb-8 text-base leading-relaxed text-white/95 sm:text-lg md:text-xl">
          {description}
        </p>
      )}

      <!-- CTAs - Optimized for Conversion -->
      <div class="mb-10 flex flex-col items-center justify-center gap-4 sm:flex-row">
        <!-- Primary CTA: Call (Larger, More Prominent) -->
        <Button
          variant="emergency"
          size="lg"
          href={`tel:${profile.contact.phone_e164}`}
          data-cta-context={context}
          class="group w-full rounded-full shadow-2xl transition-all hover:scale-105 hover:shadow-3xl sm:w-auto"
        >
          <svg class="h-6 w-6 transition-transform group-hover:rotate-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
          </svg>
          <span class="font-bold">Call {profile.contact.phone_display}</span>
        </Button>

        <!-- Secondary CTA: Book Online (Benefit-Focused) -->
        {profile.contact.booking.enabled && (
          <Button
            variant="outline"
            size="lg"
            href={profile.contact.booking.url}
            target="_blank"
            rel="noopener noreferrer"
            data-cta-context={context}
            class="group w-full rounded-full border-2 border-white bg-white/10 text-white backdrop-blur-sm transition-all hover:bg-white hover:text-brand-blue sm:w-auto"
          >
            <span class="font-semibold">Book Free Estimate</span>
            <svg class="h-5 w-5 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </Button>
        )}
      </div>

      <!-- REMOVED: Rotating urgency banner - felt manipulative and added clutter -->

      <!-- Availability Indicator -->
      <div class="mb-6 flex items-center justify-center">
        <div class="inline-flex items-center gap-2 rounded-full bg-white/10 px-4 py-2.5 backdrop-blur-sm">
          <svg class="h-5 w-5 flex-shrink-0 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span id="availability-text" class="text-sm font-semibold text-white">
            Loading availability...
          </span>
        </div>
      </div>

      <!-- Trust Indicators - Simple, non-repetitive -->
      <div class="flex flex-wrap items-center justify-center gap-4 text-sm text-white/90 sm:gap-6 sm:text-base">
        <span class="flex items-center gap-1.5">
          <svg class="h-4 w-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
          Licensed & Insured
        </span>
        <span class="flex items-center gap-1.5">
          <svg class="h-4 w-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
          TSSA Certified
        </span>
        <span class="flex items-center gap-1.5">
          <svg class="h-4 w-4 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
          Same-Day Service
        </span>
      </div>
    </div>
  </div>
</section>

<script>
  // Dynamic availability indicator
  function updateAvailability() {
    const availabilityEl = document.getElementById('availability-text');
    if (!availabilityEl) return;

    const now = new Date();
    const currentHour = now.getHours();
    const currentDay = now.getDay(); // 0 = Sunday, 6 = Saturday

    // Business hours: Mon-Fri 8am-6pm, Sat 9am-4pm, Sun closed
    let nextAvailable = '';

    // Check if current time is during business hours
    const isWeekday = currentDay >= 1 && currentDay <= 5;
    const isSaturday = currentDay === 6;
    const isSunday = currentDay === 0;

    if (isSunday) {
      // Sunday - next available is Monday
      nextAvailable = 'Monday 8:00 AM';
    } else if (isSaturday) {
      if (currentHour < 9) {
        nextAvailable = 'Today 9:00 AM';
      } else if (currentHour < 16) {
        // During Saturday hours
        const nextSlot = Math.ceil((currentHour + 1) / 2) * 2;
        if (nextSlot <= 16) {
          nextAvailable = `Today ${nextSlot > 12 ? nextSlot - 12 : nextSlot}:00 ${nextSlot >= 12 ? 'PM' : 'AM'}`;
        } else {
          nextAvailable = 'Monday 8:00 AM';
        }
      } else {
        // After Saturday hours
        nextAvailable = 'Monday 8:00 AM';
      }
    } else if (isWeekday) {
      if (currentHour < 8) {
        nextAvailable = 'Today 8:00 AM';
      } else if (currentHour < 18) {
        // During business hours - show next 2-hour window
        const nextSlot = Math.ceil((currentHour + 1) / 2) * 2;
        if (nextSlot <= 18) {
          nextAvailable = `Today ${nextSlot > 12 ? nextSlot - 12 : nextSlot}:00 ${nextSlot >= 12 ? 'PM' : 'AM'}`;
        } else {
          // After hours, show tomorrow
          if (currentDay === 5) {
            // Friday after hours
            nextAvailable = 'Monday 8:00 AM';
          } else {
            nextAvailable = 'Tomorrow 8:00 AM';
          }
        }
      } else {
        // After business hours
        if (currentDay === 5) {
          // Friday after hours
          nextAvailable = 'Monday 8:00 AM';
        } else {
          nextAvailable = 'Tomorrow 8:00 AM';
        }
      }
    }

    availabilityEl.innerHTML = `<span class="text-green-400 font-bold">‚óè</span> Next available: ${nextAvailable}`;
  }

  // Initialize on page load
  function initHeroEffects() {
    updateAvailability();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHeroEffects);
  } else {
    initHeroEffects();
  }
</script>
