---
import { getBusinessProfile, getCompanyName, getPhoneLink } from '../../lib/getBusinessProfile';
import logo from '../../images/bapheatingandcoolingltd.webp';

const profile = await getBusinessProfile();
const companyName = getCompanyName(profile);

// Map category keys to pillar page slugs
const categorySlugMap: { [key: string]: string } = {
  'heating': 'heating',
  'cooling': 'cooling',
  'iaq': 'indoor-air-quality',
  'water-heating': 'water-heating',
  'commercial': 'commercial',
  'plans': 'maintenance-plans',
};
---

<nav class="border-b bg-white" role="navigation" aria-label="Main navigation">
  <div class="container mx-auto px-4 py-4">
    <!-- Desktop/Tablet Layout: Flexbox for proper spacing -->
    <div class="flex items-center justify-between gap-4">
      <!-- Logo (Left - Fixed Width) -->
      <div class="flex-shrink-0">
        <a href="/" class="block">
          <img
            src={logo.src}
            alt={companyName}
            class="h-auto w-full max-w-[100px]"
          />
        </a>
      </div>

      <!-- Desktop Navigation Links (Center - Takes available space, centered) -->
      <div class="hidden flex-1 justify-center lg:flex">
        <ul class="flex items-center gap-6">
          {profile.services.navbar_categories.map((category) => {
            const href = category.key === 'locations' ? '/locations/' :
                         category.key === 'contact' ? '/contact-us/' :
                         `/services/${categorySlugMap[category.key]}/`;
            return (
              <li>
                <a
                  href={href}
                  class="whitespace-nowrap text-sm font-medium text-muted-foreground transition-colors hover:text-foreground"
                >
                  {category.name}
                </a>
              </li>
            );
          })}
          <li>
            <a
              href="/reviews/"
              class="whitespace-nowrap text-sm font-medium text-muted-foreground transition-colors hover:text-foreground"
            >
              Reviews
            </a>
          </li>
        </ul>
      </div>

      <!-- Right Section (CTAs) - Fixed Width -->
      <div class="flex flex-shrink-0 items-center gap-3">
        <!-- Desktop CTA Button -->
        <a
          href={getPhoneLink(profile)}
          class="hidden items-center gap-2 rounded-md bg-brand-orange px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-brand-orange-dark lg:inline-flex"
          data-cta-context="header"
        >
          <span>Call Us Now</span>
        </a>

        <!-- Mobile: Phone CTA + Hamburger -->
        <a
          href={getPhoneLink(profile)}
          class="inline-flex items-center gap-1.5 rounded-md bg-brand-orange px-3 py-2 text-sm font-semibold text-white hover:bg-brand-orange-dark lg:hidden"
          data-cta-context="header-mobile"
        >
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
          </svg>
          <span class="hidden sm:inline">Call</span>
        </a>
        <button
          id="mobile-menu-button"
          type="button"
          class="inline-flex items-center justify-center rounded-md p-2 text-foreground hover:bg-muted focus:outline-none focus:ring-2 focus:ring-primary lg:hidden"
          aria-expanded="false"
          aria-label="Toggle navigation menu"
        >
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation Menu (Full Width) -->
  <div id="mobile-menu" class="hidden border-t bg-white lg:hidden">
    <div class="container mx-auto px-4">
      <ul class="space-y-1 pb-3 pt-4">
        {profile.services.navbar_categories.map((category) => {
          const href = category.key === 'locations' ? '/locations/' :
                       category.key === 'contact' ? '/contact-us/' :
                       `/services/${categorySlugMap[category.key]}/`;
          return (
            <li>
              <a
                href={href}
                class="block rounded-md px-3 py-2 text-base font-medium transition-colors hover:bg-muted"
              >
                {category.name}
              </a>
            </li>
          );
        })}
        <li>
          <a
            href="/reviews/"
            class="block rounded-md px-3 py-2 text-base font-medium transition-colors hover:bg-muted"
          >
            Reviews
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    if (menuButton && mobileMenu) {
      menuButton.addEventListener('click', () => {
        const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';

        // Toggle menu visibility
        if (isExpanded) {
          mobileMenu.classList.add('hidden');
          menuButton.setAttribute('aria-expanded', 'false');
        } else {
          mobileMenu.classList.remove('hidden');
          menuButton.setAttribute('aria-expanded', 'true');
        }
      });

      // Close menu when clicking a link
      const menuLinks = mobileMenu.querySelectorAll('a');
      menuLinks.forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.classList.add('hidden');
          menuButton.setAttribute('aria-expanded', 'false');
        });
      });

      // Close menu when clicking outside
      document.addEventListener('click', (event) => {
        const target = event.target as HTMLElement;
        if (!menuButton.contains(target) && !mobileMenu.contains(target)) {
          mobileMenu.classList.add('hidden');
          menuButton.setAttribute('aria-expanded', 'false');
        }
      });
    }
  });
</script>
